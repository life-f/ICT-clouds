# Лабораторная работа №1

## Цель:

**Настроить nginx по заданному тз:**

1. Должен работать по https c сертификатом
2. Настроить принудительное перенаправление HTTP-запросов (порт 80) на HTTPS (порт 443) для обеспечения безопасного
   соединения.
3. Использовать alias для создания псевдонимов путей к файлам или каталогам на сервере.
4. Настроить виртуальные хосты для обслуживания нескольких доменных имен на одном сервере.
5. Что угодно еще под требования проекта

**Результат:**

Предположим, что у вас есть два пет проекта на одном сервере, которые должны быть доступны по https. Настроенный вами
веб сервер умеет работать по https, относить нужный запрос к нужному проекту, переопределять пути исходя из требований
пет проектов.
В качестве пет проектов можете использовать что-то свое, можете что-то опенсорсное, можете просто код из трех строчек
как например здесь

**Важно:**

В этой лабе прошу вас не углубляться в безопасность nginx, тк так будет интереснее делать лабу со звездочкой)

## Выполнение

### Введение

Для выполнения задания используется тестовый сервер с размещенной CRM строительной компании.
Проект написан на Python с использованием фреймворка Django.

Проект размещен на облачном сервере с ОС Ubuntu.

**Нюансы проекта:**

1. Для веб-сокетов используется бибилиотека channels
2. Для asgi используется Daphne

### 1. Исходное состояние сервера
Изначальная конфигурация тестового сервера (работает только на http)

![Изначальная конфигурация тестового nginx](img1.png)

Сайт запущен, работает и доступен по http, что видно на рисунке ниже

![Работающий сайт](Img2.png)

### 2. Установка SSL-сертификата

Для установки Let's Encrypt SSL-сертификата на сервер использовался Certbot, установленный с помощью команды:

`sudo apt install certbot python3-certbot-nginx`

Проверяем настройки брандмауэра, он должен пропускать http и https трафик

![Конфигурация брандмауэра](img3.png)

Получаем сертификат с помощью команды:

`sudo certbot --nginx -d not-work24.tw1.ru`

![Полученный сертификат](img4.png)

Добавление автообновления сертификатов происходит посредством команд:

`crontab -e`

В файл с крон-работы добавляется запись:

`30 3 * * 2 /usr/bin/certbot renew >> /var/log/renew-ssl.log`

Конфигурация NGINX после подключения сертификата:
![Готовая конфигурация](img.png)

На конфигурации виден 301 редирект на https

Проверка работы сайта:
![img_2.png](img_2.png)

На прод-сервере конфигурация с wildcard Let's Encrypt сертификатом
![Wildcard конфигурация](img_1.png)
