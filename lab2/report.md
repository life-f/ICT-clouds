# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ2

## –¶–µ–ª—å

–ù–∞–ø–∏—Å–∞—Ç—å 2 Dockerfile:
1. "–ü–ª–æ—Ö–æ–π" (bad), –≤ –∫–æ—Ç–æ—Ä–æ–º >= 3 –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–∞
2. "–•–æ—Ä–æ—à–∏–π" (nice), –≤ –∫–æ—Ç–æ—Ä–æ–º –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

## –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

–î–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–∏–≤–µ–¥–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é "–ø–ª–æ—Ö–æ–π" Dockerfile:
```
FROM ubuntu:latest

RUN apt-get update

RUN apt-get install -y python3 
        
ADD . .

CMD ["python3", "hello.py"]
```

–ê —Ç–µ–ø–µ—Ä—å "—Ö–æ—Ä–æ—à–∏–π" Dockerfile:
```
FROM python:3.9.6

RUN apt-get update && pip3 install pyyaml

COPY . .

CMD ["python3", "hello.py"]
```
### –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ—Ç–ª–∏—á–∏—è –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞<br>
`FROM ubuntu:latest` üëé<br>
`FROM FROM python:3.9.6` üëç<br>
–í –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ "–ø–ª–æ—Ö–æ–≥–æ" Dockerfile'–∞:<br>
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞ –Ω–µ—Å–æ—Ä–∞–∑–º–µ—Ä–Ω–æ –∑–∞–¥–∞—á–µ -- —Ü–µ–ª–∞—è —É–±—É–Ω—Ç—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–∏—Ç–æ–Ω–æ–≤—Å–∫–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
* –ù–µ—Ç —É–∫–∞–∑–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ -- –∫–∞–∫ –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤ –±—É–¥—É—â–µ–º

2. –ê—Ç–æ–º–∞—Ä–Ω—ã–µ RUN'—ã<br>
`RUN apt-get update` <br>
`RUN apt-get install -y python3`üëé<br>
`RUN apt-get update && pip3 install pyyaml` üëç<br>
–ö–∞–∂–¥—ã–π RUN —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Å–ª–æ–π, —á—Ç–æ —Ä–∞–∑–¥—É–≤–∞–µ—Ç –æ–±—Ä–∞–∑.<br>
–ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π —Å–ª–æ–π ‚Äî —ç—Ç–æ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –æ–±—Ä–∞–∑–∞. –ê —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ ‚Äî —ç—Ç–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–ª–æ–µ–≤ –≤ –æ–¥–∏–Ω.<br>
–ö–∞–∂–¥—ã–π —Å–ª–æ–π –æ–±—Ä–∞–∑–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, —á—Ç–æ–±—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –±—ã—Å—Ç—Ä–æ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å—Å—è –Ω–∞–∑–∞–¥.

4. ADD –∏ COPY<br>
`ADD . .` üëé<br>
`COPY . .` üëç<br>
–í —Ü–µ–ª–æ–º –∫–æ–º–∞–Ω–¥—ã –¥–µ–ª–∞—é—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ ADD –º–æ–∂–µ—Ç –∏ "–ª–∏—à–∫–∞–Ω—É—Ç—å", –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å —Ä–∞—Å–ø–∞–∫–æ–≤–∫–æ–π –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞ (—Ö–æ—Ç—å –≤ –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ —É –Ω–∞—Å –µ–≥–æ –∏ –Ω–µ—Ç).<br>
–ö–æ–º–∞–Ω–¥–∞ COPY, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª—É—á—à–µ –¥–ª—è –Ω–∞—à–µ–π –∑–∞–¥–∞—á–∏.

### –û—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
–ù–æ –¥–∞–∂–µ —Å –∏–¥–µ–∞–ª—å–Ω–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–º Dockerfile –µ—Å—Ç—å –º–∞—Å—Å–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –≤—Å–µ –∏—Å–ø–æ—Ä—Ç–∏—Ç—å. –ü—Ä–∏–≤–µ–¥–µ–º –ø–∞—Ä–æ—á–∫—É —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:
1. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–µ–Ω–µ—Ä–∞ —Å –ø—Ä–∞–≤–∞–º–∏ root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ö–æ–≥–¥–∞ –º—ã –¥–∞–µ–º –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π —Å–≤–µ—Ä—Ö –Ω—É–∂–Ω–æ–≥–æ, —Ç–æ —Å–æ–∑–¥–∞–µ–º —Å–µ—Ä—å–µ–∑–Ω—ã–µ —Ä–∏—Å–∫–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ï—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ÉüòÆ, –¥–∞–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –Ω–µ —Ö–æ—á–µ—Ç—Å—è...
2. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º (–ø–∞–º—è—Ç–∏) –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ç–æ–º—É, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—É–¥–µ—Ç –ø–æ—Ç—Ä–µ–ª—è—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã —Ö–æ—Å—Ç–∞, —á—Ç–æ, —Å–∞–º–æ —Å–æ–±–æ–π, —Å–∫–∞–∂–µ—Ç—Å—è –Ω–∞ —Ä–∞–±–æ—Ç–µ –¥—Ä—É–≥–∏—Ö –∫–æ–Ω—Ç–µ–π–µ–Ω–µ—Ä–æ–≤. –ö–æ–º—É —Ç–∞–∫–æ–µ –Ω–∞–¥–æ??

## –í—ã–≤–æ–¥

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã –∑–Ω–∞–Ω–∏—è –æ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö Dockerfile. –ú–Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å üëç

# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ2*(—Å–æ –∑–≤–µ–∑–¥–æ—á–∫–æ–π)

## –¶–µ–ª—å

–ù–∞–ø–∏—Å–∞—Ç—å 2 Docker-compose —Ñ–∞–π–ª–∞:
1. "–ü–ª–æ—Ö–æ–π" (bad), –≤ –∫–æ—Ç–æ—Ä–æ–º >= 3 –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–∞
2. "–•–æ—Ä–æ—à–∏–π" (nice), –≤ –∫–æ—Ç–æ—Ä–æ–º –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
3. –°–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–≥–æ compose-–ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–¥–Ω–∏–º–∞–ª–∏—Å—å –≤–º–µ—Å—Ç–µ, –Ω–æ –Ω–µ "–≤–∏–¥–µ–ª–∏" –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –ø–æ —Å–µ—Ç–∏

## –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

–î–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–∏–≤–µ–¥–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é "–ø–ª–æ—Ö–æ–π" Docker-compose —Ñ–∞–π–ª:
```
services:
  web:
    image: nginx:latest
    ports:
      - 80:80
    depends_on:
      - db

  db:
    image: postgres:latest
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: pwd
    ports:
      - 5432:5432
```

–ê —Ç–µ–ø–µ—Ä—å "—Ö–æ—Ä–æ—à–∏–π" Docker-compose —Ñ–∞–π–ª:
```
services:
  web:
    image: nginx:1.21.1
    networks:
      - webnet
    ports:
      - 127.0.0.1:80:80
    depends_on:
      - db
	  
  db:
    image: postgres:13.3
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD_FILE: /run/secrets/admin_password
    secrets:
      - admin_password
    networks:
      - dbnet
    ports:
      - 127.0.0.1:5432:5432

networks:
  webnet:
  dbnet:

secrets:
  admin_password:
    file: admin_password.txt
```
### –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ—Ç–ª–∏—á–∏—è –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

1. –í—Å–µ —Ç–æ—Ç –∂–µ —Ç–µ–≥ `latest`<br>
`image: nginx:latest` üëé<br>
`image: nginx:1.21.1` üëç<br>
–ü–æ—Ä–∞ –±—ã —É–∂–µ –∑–∞–ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ —ç—Ç–æ –ø–ª–æ—Ö–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞.<br>

2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ —Ö–æ—Å—Ç–∞ –Ω–∞ –∞–¥—Ä–µ—Å–µ `0.0.0.0`<br>
`- 80:80`üëé<br>
`- 127.0.0.1:80:80` üëç<br>
–ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞—Ç—å –ø–æ—Ä—Ç, —Ç–æ –æ–Ω –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—Å—è —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ —Ö–æ—Å—Ç —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Ö–æ—Å—Ç–∞.<br>
–í–∫–ª—é—á–∞—è —Ç–æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã—Ö–æ–¥–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å–µ—Ç—å –ò–Ω—Ç–µ—Ä–Ω–µ—ÇüòÆ.<br>
–ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å `localhost`, —Ç–æ –ø–æ—Ä—Ç –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º —Ç–æ–ª—å–∫–æ –¥–ª—è `loopback` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

4. –•—Ä–∞–Ω–µ–Ω–∏–µ `—Å–µ–Ω—Å–∏—Ç–∏–≤ –∏–Ω—Ñ–æ—Ä–º–µ–π—à–µ–Ω` –≤ compose —Ñ–∞–π–ª–µ<br>
`POSTGRES_PASSWORD: pwd` üëé<br>
`POSTGRES_PASSWORD_FILE: /run/secrets/admin_password` üëç<br>
–ó–¥–µ—Å—å –¥–∞–∂–µ –∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—á–µ–≥–æ: —á—Ç–æ –µ—Å–ª–∏ –Ω–∞—à compose —Ñ–∞–π–ª –ø–æ–ø–∞–¥–µ—Ç –≤ —Ä—É–∫–∏ –∫–∞–∫–æ–≥–æ-–Ω–∏–±—É–¥—å –Ω–µ–≥–æ–¥—è–π—Å–∫–æ–≥–æ –Ω–µ–≥–æ–¥—è—è?..–ê —Ç–∞–º –ø–∞—Ä–æ–ª—å.<br>

### –°–µ—Ç–µ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±—ã–ª–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥ –¥—Ä—É–≥–∞ —Å –ø–æ–º–æ—à—å—é `networks`: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å `nginx` –æ–±—Ä–∞–∑–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ `webnet`, `postgres` –≤ `dbnet`.

## –í—ã–≤–æ–¥

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –±—ã–ª–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Docker-compose —Ñ–∞–π–ª–∞–º–∏. –õ–∞–π–∫ üëç
